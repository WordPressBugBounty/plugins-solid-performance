(()=>{"use strict";var e={20:(e,a,t)=>{var r=t(609),o=Symbol.for("react.element"),n=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),c=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};a.jsx=function(e,a,t){var r,l={},i=null,d=null;for(r in void 0!==t&&(i=""+t),void 0!==a.key&&(i=""+a.key),void 0!==a.ref&&(d=a.ref),a)n.call(a,r)&&!s.hasOwnProperty(r)&&(l[r]=a[r]);if(e&&e.defaultProps)for(r in a=e.defaultProps)void 0===l[r]&&(l[r]=a[r]);return{$$typeof:o,type:e,key:i,ref:d,props:l,_owner:c.current}}},848:(e,a,t)=>{e.exports=t(20)},609:e=>{e.exports=window.React}},a={};function t(r){var o=a[r];if(void 0!==o)return o.exports;var n=a[r]={exports:{}};return e[r](n,n.exports,t),n.exports}t.n=e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},t.d=(e,a)=>{for(var r in a)t.o(a,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:a[r]})},t.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={};t.r(e),t.d(e,{PRELOADER_CANCEL:()=>E,PRELOADER_START:()=>f,SET_PRELOAD_STATUS:()=>_,cancelPreloader:()=>C,preloaderCancel:()=>y,preloaderStart:()=>b,refreshPreloadStatus:()=>S,startPreloader:()=>P,updatePreloadStatus:()=>w});var a={};t.r(a),t.d(a,{getPreloadStatus:()=>N});var r={};t.r(r),t.d(r,{getPreloadStatus:()=>k});var o=t(609);const n=window.wp.element,c=window.wp.i18n,s=window.wp.components,l=window.wp.data,i=window.wp.apiFetch;var d=t.n(i);function p(){const e=(0,l.useSelect)((e=>e("core/notices").getNotices().filter((e=>"snackbar"===e.type))),[]),a=(0,l.useSelect)((e=>e("core/notices").getNotices().filter((e=>"default"===e.type))),[]),{removeNotice:t}=(0,l.useDispatch)("core/notices");return(0,o.createElement)(o.Fragment,null,(0,o.createElement)(s.NoticeList,{className:"components-editor-notices__default",notices:a,onRemove:t}),(0,o.createElement)("div",{className:"swpsp-notice-wrap"},(0,o.createElement)(s.SnackbarList,{className:"components-editor-notices__snackbar",notices:e,onRemove:t})))}const m=window.wp.notices,h="swpsp-preload-id",g=e=>sessionStorage.setItem(h,e),u=()=>null!==sessionStorage.getItem(h),_="SET_PRELOAD_STATUS",f="PRELOADER_START",E="PRELOADER_CANCEL";let v=null;const w=e=>({type:_,newState:e}),b=e=>({type:f,notice:e}),y=e=>({type:E,notice:e}),S=()=>async({select:e,dispatch:a,registry:t})=>{const r=await d()({path:"/solid-performance/v1/page/cache-count"}),o=await d()({path:"/solid-performance/v1/page/preload"});let n={isPreloading:o.running,cacheCount:r.count,progressPercent:o.progress,source:o.source,preloadId:o.preloadId};switch(o.code){case"solid_performance_preloader_completed":case"solid_performance_preloader_canceled":{const a=await e.getPreloadStatus();!u()&&a.isPreloading&&("solid_performance_preloader_canceled"===o.code?t.dispatch(m.store).createInfoNotice(o.message):t.dispatch(m.store).createSuccessNotice(o.message),g(o.preloadId)),u()||a.isPreloading||g(o.preloadId);break}case"solid_performance_preloader_stalled":t.dispatch(m.store).createWarningNotice(o.message,{type:"snackbar"});break;case"solid_performance_preloader_failed":t.dispatch(m.store).createErrorNotice(o.message)}return n={...n,notice:{code:o.code,message:o.message}},a(w(n)),n},P=(e=!1)=>async({dispatch:a,registry:t})=>{let r;v&&v.abort(),v=new AbortController,a(w({isPreloading:!0}));try{const t=await d()({path:"/solid-performance/v1/page/preload",method:"POST",data:{force:e},signal:v.signal});t&&"solid_performance_preloader_started"===t.code?(r={type:"success",code:t.code,message:t.message},a(b(r)),a(S())):r={type:"error",message:(0,c.__)("Error starting preloader.","solid-performance")}}catch(e){if("AbortError"===e.name)return;r={type:"error",message:e.message||(0,c.__)("An unexpected error occurred.","solid-performance")}}t.dispatch(m.store).createNotice(r.type,r.message,{type:"snackbar"})},C=()=>async({dispatch:e,registry:a})=>{let t;v&&(v.abort(),v=null),e(w({isPreloading:!1}));try{const a=await d()({path:"/solid-performance/v1/page/preload",method:"DELETE"});a&&a.message?(t={type:"success",code:a.code,message:a.message},e(y(t)),e(S())):t={type:"error",message:(0,c.__)("Error canceling preloader.","solid-performance")}}catch(e){if("AbortError"===e.name)return;t={type:"error",message:e.message||(0,c.__)("An unexpected error occurred.","solid-performance")}}a.dispatch(m.store).createNotice(t.type,t.message,{type:"snackbar"})},x={isPreloading:!1,cacheCount:0,progressPercent:0,source:"",preloadId:"",notice:{type:"",code:"",message:""}},N=e=>e,k=()=>async({dispatch:e})=>{await e(S())},T=(0,l.createReduxStore)("solid-performance/preload",{reducer:(e=x,a)=>{switch(a.type){case _:return a.newState.isPreloading&&sessionStorage.removeItem(h),{...e,...a.newState};case f:return{...e,isPreloading:!0,notice:a.notice};case E:return{...e,isPreloading:!1,notice:a.notice};default:return e}},actions:e,selectors:a,resolvers:r});function R({preloadStatus:e}){const{isPreloading:a,source:t,progressPercent:r}=e;return a?(0,o.createElement)("div",{className:"preloading-progress"},(0,o.createElement)("p",null,t?(0,c.sprintf)(/* translators: %s: The source of what initiated or canceled the preloader. */ /* translators: %s: The source of what initiated or canceled the preloader. */
(0,c.__)("Preloading via %s in progress","solid-performance"),t):(0,c.__)("Starting preloader","solid-performance"),(0,o.createElement)("span",{className:"dots"})),(0,o.createElement)("div",null,(0,o.createElement)(s.ProgressBar,{value:r,className:"preload-progress-bar"}))):null}function z({isPreloading:e,text:a,label:t,force:r=!1,hidden:n=!1}){if(n)return null;const{startPreloader:i,cancelPreloader:d}=(0,l.useDispatch)(T),p=e?(0,c.__)("Cancel Preloading","solid-performance"):a,m=(0,o.createElement)(s.Button,{variant:"secondary",onClick:async()=>{e?await d():await i(r)}},p),h=t?.length>80?"swpsp-preload-long-tooltip":"";return t?(0,o.createElement)(s.Tooltip,{text:t,className:h},m):m}(0,l.register)(T);const B=(0,n.forwardRef)((function({icon:e,size:a=24,...t},r){return(0,n.cloneElement)(e,{width:a,height:a,...t,ref:r})})),A=window.wp.primitives;var M=t(848);const O=(0,M.jsx)(A.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,M.jsx)(A.Path,{d:"M12 3.2c-4.8 0-8.8 3.9-8.8 8.8 0 4.8 3.9 8.8 8.8 8.8 4.8 0 8.8-3.9 8.8-8.8 0-4.8-4-8.8-8.8-8.8zm0 16c-4 0-7.2-3.3-7.2-7.2C4.8 8 8 4.8 12 4.8s7.2 3.3 7.2 7.2c0 4-3.2 7.2-7.2 7.2zM11 17h2v-6h-2v6zm0-8h2V7h-2v2z"})});function D({count:e}){return(0,o.createElement)("p",null,(0,o.createElement)(B,{icon:O,size:32,style:{verticalAlign:"bottom",fill:"var(--grape-purple-110)"}}),(0,n.createInterpolateElement)((0,c._n)("<Number /> page cached","<Number /> pages cached",e,"solid-performance"),{Number:(0,o.createElement)("b",null,e)}))}const I="htaccess",L="php",V=({performanceSettings:e,setState:a})=>{var t;const[r,n]=(0,o.useState)(!0),{createErrorNotice:i,createSuccessNotice:p}=(0,l.useDispatch)(m.store),{method:h}=null!==(t=e?.page_cache?.cache_delivery)&&void 0!==t?t:"",g=swspParams.cacheDelivery.htaccess.supported,u=[{disabled:!0,label:(0,c.__)("Select a Page Cache Method","solid-performance"),value:""},Boolean(g)&&{label:(0,c.__)("htaccess","solid-performance"),value:I},{label:(0,c.__)("php","solid-performance"),value:L}].filter(Boolean);return(0,o.createElement)(s.Card,null,(0,o.createElement)(s.CardHeader,null,(0,o.createElement)("h2",null,(0,c.__)("Page Cache Delivery","solid-performance")),(0,o.createElement)(s.Button,{variant:"text",href:"https://go.solidwp.com/performance-page-cache-delivery",icon:()=>(0,o.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24","aria-hidden":"true",focusable:"false"},(0,o.createElement)("path",{d:"M12 4.75a7.25 7.25 0 100 14.5 7.25 7.25 0 000-14.5zM3.25 12a8.75 8.75 0 1117.5 0 8.75 8.75 0 01-17.5 0zM12 8.75a1.5 1.5 0 01.167 2.99c-.465.052-.917.44-.917 1.01V14h1.5v-.845A3 3 0 109 10.25h1.5a1.5 1.5 0 011.5-1.5zM11.25 15v1.5h1.5V15h-1.5z"})),target:"_blank",size:"small",showTooltip:!0,label:"View external documentation"})),(0,o.createElement)(s.CardBody,null,(0,o.createElement)(s.SelectControl,{__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:(0,c.__)("Page Cache Method","solid-performance"),help:(0,c.__)('The "htaccess" method bypasses PHP and should provide better performance, but it disables any response header caching (these will be stripped). Defaults to "htaccess" if Apache is detected on the hosting server.',"solid-performance"),onChange:e=>{a({page_cache:{cache_delivery:{method:e}}}),n(!1)},value:h,options:u}),g&&h===I&&r&&(0,o.createElement)(o.Fragment,null,(0,o.createElement)(s.BaseControl,null,(0,o.createElement)(s.Button,{variant:"secondary",onClick:async()=>{await d()({path:"/solid-performance/v1/page/htaccess",method:"POST"}).then((e=>{p(e.message,{type:"snackbar"})})).catch((e=>{i(e.message,{type:"snackbar"}),console.error(e)}))}},(0,c.__)("Regenerate htaccess rules","solid-performance")),(0,o.createElement)(s.Button,{variant:"tertiary",onClick:async()=>{await d()({path:"/solid-performance/v1/page/htaccess",method:"DELETE"}).then((e=>{p(e.message,{type:"snackbar"})})).catch((e=>{i(e.message,{type:"snackbar"}),console.error(e)}))}},(0,c.__)("Remove htaccess rules","solid-performance")))),(0,o.createElement)("p",{className:"submit"},(0,o.createElement)(s.Button,{variant:"primary",type:"submit",onClick:()=>n(!0)},(0,c.__)("Save","solid-performance")))))},F=document.querySelector(".solidwp-performance-settings-main");F&&(0,n.createRoot)(F).render((0,o.createElement)((()=>{const{createErrorNotice:e,createSuccessNotice:a}=(0,l.useDispatch)(m.store),[t,r]=(0,o.useState)(swspParams.settings),n=(0,l.useSelect)((e=>e(T).getPreloadStatus()),[]),{isPreloading:i,cacheCount:h}=n,g=(0,l.useDispatch)(T),{refreshPreloadStatus:u}=g,_=async()=>{try{const{solid_performance_settings:e}=await d()({path:"/wp/v2/settings"});r(e)}catch(a){e((0,c.__)("Error: Unable to load settings.","solid-performance")),console.error(a)}},f=async()=>u();(0,o.useEffect)((()=>{_(),f()}),[]),(0,o.useEffect)((()=>{const e=setInterval(f,i?3e3:8e3);return()=>clearInterval(e)}),[n]);const E=async()=>{await d()({path:"/solid-performance/v1/page/clear",method:"POST"}).catch((a=>{e(a.message,{type:"snackbar"}),console.error(a)})),a((0,c.__)("Cache Cleared","solid-performance"),{type:"snackbar"}),await f()},v=async()=>{const t=await d()({path:"/solid-performance/v1/page/regenerate",method:"POST"}).catch((a=>{e((0,c.__)("Error Regenerating","solid-performance"),{type:"snackbar"}),console.error(a)}));if("solid_performance_advanced_cache_regenerated"!==t.code)e((0,c.__)("Error Regenerating","solid-performance"),{type:"snackbar"}),console.error(t);else{a((0,c.__)("advanced-cache.php Regenerated","solid-performance"),{type:"snackbar"});const e=document.getElementById("solidwp-performance-inactive");e&&e.remove()}},w=e=>{r({...t,...e,page_cache:{...t?.page_cache,...e?.page_cache}})},b=[{name:"basic",title:(0,c.__)("Basic","solid-performance"),className:"basic-tab"},{name:"advanced",title:(0,c.__)("Advanced","solid-performance"),className:"advanced-tab"}];return(0,o.createElement)(o.Fragment,null,(0,o.createElement)(s.Flex,{align:"baseline"},(0,o.createElement)(s.FlexItem,null,(0,o.createElement)("h1",null,(0,c.__)("Performance Settings","solid-performance"))),(0,o.createElement)(s.FlexItem,{style:{paddingRight:"20px"},className:"swpsp-page-count"},(0,o.createElement)(D,{count:h}))),(0,o.createElement)(p,null),(0,o.createElement)("form",{className:"swpsp-settings-form",onSubmit:async o=>{o.preventDefault(),await d()({path:"/wp/v2/settings",method:"POST",data:{solid_performance_settings:{...t}}}).then((e=>{const{solid_performance_settings:t}=e;t&&(a((0,c.__)("Settings Saved","solid-performance"),{type:"snackbar"}),r(t))})).catch((a=>{_(),e(a.message,{type:"snackbar"}),console.error(a)}))}},(0,o.createElement)(s.TabPanel,{className:"swpsp-settings-section-tabs",orientation:"vertical",tabs:b},(e=>{switch(e.name){case"basic":return(0,o.createElement)(s.Card,null,(0,o.createElement)(s.CardHeader,null,(0,o.createElement)("header",null,(0,o.createElement)("h2",null,(0,c.__)("Basic Settings","solid-performance")),t?.page_cache?.enabled&&(0,o.createElement)(o.Fragment,null,(0,o.createElement)(s.Button,{variant:"secondary",onClick:E,disabled:i},(0,c.__)("Purge Page Cache","solid-performance")),(0,o.createElement)(z,{isPreloading:i,text:(0,c.__)("Preload Uncached Pages","solid-performance"),force:!1,hidden:i,label:(0,c.__)("Generates cache files only for URLs that are not already cached","solid-performance")}),(0,o.createElement)(z,{isPreloading:i,text:(0,c.__)("Preload & Refresh All","solid-performance"),force:!0,label:(0,c.__)("Cached URLs are served from the existing cache until each is replaced during the site-wide preloading pass","solid-performance")})),(0,o.createElement)(s.Button,{variant:"text",href:"https://go.solidwp.com/performance-page-caching",icon:()=>(0,o.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24","aria-hidden":"true",focusable:"false"},(0,o.createElement)("path",{d:"M12 4.75a7.25 7.25 0 100 14.5 7.25 7.25 0 000-14.5zM3.25 12a8.75 8.75 0 1117.5 0 8.75 8.75 0 01-17.5 0zM12 8.75a1.5 1.5 0 01.167 2.99c-.465.052-.917.44-.917 1.01V14h1.5v-.845A3 3 0 109 10.25h1.5a1.5 1.5 0 011.5-1.5zM11.25 15v1.5h1.5V15h-1.5z"})),target:"_blank",size:"small",showTooltip:!0,label:"View external documentation"}))),(0,o.createElement)(s.CardBody,null,(0,o.createElement)(R,{preloadStatus:n}),(0,o.createElement)(s.ToggleControl,{label:(0,c.__)("Enable Page Cache","solid-performance"),checked:t?.page_cache?.enabled||!1,className:"swpsp-large-toggle",onChange:e=>w({page_cache:{enabled:e}})}),(0,o.createElement)("p",{className:"submit"},(0,o.createElement)(s.Button,{variant:"primary",type:"submit"},(0,c.__)("Save","solid-performance")))));case"advanced":return(0,o.createElement)(o.Fragment,null,(0,o.createElement)(s.Card,null,(0,o.createElement)(s.CardHeader,null,(0,o.createElement)("header",null,(0,o.createElement)("h2",null,(0,c.__)("Advanced Settings","solid-performance")),(0,o.createElement)(s.Button,{variant:"text",href:"https://go.solidwp.com/performance-exclusions",icon:()=>(0,o.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24","aria-hidden":"true",focusable:"false"},(0,o.createElement)("path",{d:"M12 4.75a7.25 7.25 0 100 14.5 7.25 7.25 0 000-14.5zM3.25 12a8.75 8.75 0 1117.5 0 8.75 8.75 0 01-17.5 0zM12 8.75a1.5 1.5 0 01.167 2.99c-.465.052-.917.44-.917 1.01V14h1.5v-.845A3 3 0 109 10.25h1.5a1.5 1.5 0 011.5-1.5zM11.25 15v1.5h1.5V15h-1.5z"})),target:"_blank",size:"small",showTooltip:!0,label:"View external documentation"}))),(0,o.createElement)(s.CardBody,null,(0,o.createElement)(s.ToggleControl,{label:(0,c.__)("Lazy Load Images","solid-performance"),checked:t?.page_cache?.lazy_loading?.enabled||!1,help:(0,c.__)("Automatically lazy load inline CSS background images.","solid-performance"),onChange:e=>w({page_cache:{lazy_loading:{enabled:e}}})}),(0,o.createElement)(s.ToggleControl,{label:(0,c.__)("Cloudflare Image Transformation","solid-performance"),checked:t?.page_cache?.image_transformation?.enabled||!1,help:(0,c.__)("Rewrite image URLs to use Cloudflare Images to load image sizes directly from the edge. This needs to be enabled in your Cloudflare dashboard.","solid-performance"),onChange:e=>w({page_cache:{image_transformation:{processor:"cloudflare",enabled:e}}})}),(0,o.createElement)(s.TextareaControl,{label:(0,c.__)("Cache Exclusions","solid-performance"),help:(0,c.__)("Enter URLs for pages, or wildcard exclusion patterns to exclude from the cache, one per line. Changes purge the entire cache when using htaccess mode.","solid-performance"),placeholder:(0,c.__)("/example/*","solid-performance"),value:t?.page_cache?.exclusions?.join("\n")||"",onChange:e=>w({page_cache:{exclusions:e.split("\n")}})}),(0,o.createElement)("p",{className:"submit"},(0,o.createElement)(s.Button,{variant:"primary",type:"submit"},(0,c.__)("Save","solid-performance"))))),(0,o.createElement)(V,{performanceSettings:t,setState:w}),(0,o.createElement)(s.Card,null,(0,o.createElement)(s.CardHeader,null,(0,o.createElement)("header",null,(0,o.createElement)("h2",null,(0,c.__)("Debug","solid-performance")),(0,o.createElement)(s.Button,{variant:"text",href:"https://go.solidwp.com/performance-directory",icon:()=>(0,o.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24","aria-hidden":"true",focusable:"false"},(0,o.createElement)("path",{d:"M12 4.75a7.25 7.25 0 100 14.5 7.25 7.25 0 000-14.5zM3.25 12a8.75 8.75 0 1117.5 0 8.75 8.75 0 01-17.5 0zM12 8.75a1.5 1.5 0 01.167 2.99c-.465.052-.917.44-.917 1.01V14h1.5v-.845A3 3 0 109 10.25h1.5a1.5 1.5 0 011.5-1.5zM11.25 15v1.5h1.5V15h-1.5z"})),target:"_blank",size:"small",showTooltip:!0,label:"View external documentation"}))),(0,o.createElement)(s.CardBody,null,(0,o.createElement)(s.ToggleControl,{label:(0,c.__)("Enable Debug Mode","solid-performance"),help:(0,c.__)("Enable debug mode to log cache status and performance information.","solid-performance"),checked:t?.page_cache?.debug||!1,onChange:e=>w({page_cache:{debug:e}})}),(0,o.createElement)(s.TextControl,{label:(0,c.__)("Cache File Directory","solid-performance"),help:(0,c.__)("The directory where cache files are stored on the server.","solid-performance"),value:t?.page_cache?.cache_dir||"",onChange:()=>{},readOnly:!0}),(0,o.createElement)(s.BaseControl,null,(0,o.createElement)(s.Button,{variant:"secondary",onClick:v},(0,c.__)("Regenerate the advanced-cache.php file","solid-performance"))),(0,o.createElement)("p",{className:"submit"},(0,o.createElement)(s.Button,{variant:"primary",type:"submit"},(0,c.__)("Save","solid-performance"))))))}}))))}),null))})()})();